{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":11,"column":0,"index":226},"end":{"line":11,"column":57,"index":283}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"expo-notifications","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":12,"column":0,"index":284},"end":{"line":12,"column":52,"index":336}}],"key":"nrBDtkRVez7cBhLzyaRjl+xVfvE=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":13,"column":0,"index":337},"end":{"line":13,"column":69,"index":406}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"axios","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":14,"column":0,"index":407},"end":{"line":14,"column":26,"index":433}}],"key":"e45rENb5cSu0Yeh6oC1uWb7lEp4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function(g,r,i,a,m,_e,_d){\"use strict\";function e(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(_e,'__esModule',{value:!0}),Object.defineProperty(_e,\"useSmartDelay\",{enumerable:!0,get:function(){return u}}),Object.defineProperty(_e,\"setupNotificationHandler\",{enumerable:!0,get:function(){return l}});var t=r(_d[0]),n=(function(e){if(e&&e.__esModule)return e;var t={};return e&&Object.keys(e).forEach(function(n){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}),t.default=e,t})(r(_d[1])),o=e(r(_d[2])),s=e(r(_d[3]));const c=\"http://localhost:8000\",u=()=>{const[e,u]=(0,t.useState)(!1),[l,d]=(0,t.useState)(null),[f,p]=(0,t.useState)(null),[y,h]=(0,t.useState)(null),[w,_]=(0,t.useState)(!1),[k,b]=(0,t.useState)(null),E=(0,t.useCallback)(async()=>{try{d(null);const{status:e}=await n.requestPermissionsAsync(),t='granted'===e;if(u(t),t){return!!await P()}return!1}catch(e){const t=e instanceof Error?e.message:'Unknown error';return d(t),!1}},[]),P=(0,t.useCallback)(async()=>{try{h(null);throw new Error('EXPO_PUBLIC_EAS_PROJECT_ID not configured')}catch(e){const t=e instanceof Error?e.message:'Unknown error';return h(t),null}},[]),S=(0,t.useCallback)(async e=>{try{h(null);let t=f;if(t||(t=await P()),!t)throw new Error('Failed to get push token');return!0===(await s.default.post(`${c}/push/register`,{token:t,subscription_id:e})).data.success}catch(e){const t=e instanceof Error?e.message:'Unknown error';return h(t),!1}},[f]),v=(0,t.useCallback)(async(e,t)=>{try{_(!0),b(null);const n=await s.default.post(`${c}/trips/planned`,{...e,subscription_id:t});if(n.data.trip_id)return n.data.trip_id;throw new Error('No trip_id in response')}catch(e){const t=e instanceof Error?e.message:'Unknown error';return b(t),null}finally{_(!1)}},[]);return(0,t.useEffect)(()=>{(async()=>{try{const e=await o.default.getItem('expo_push_token');e&&p(e)}catch(e){console.warn('Failed to load cached push token:',e)}})()},[]),{requestPermissions:E,permissionsGranted:e,permissionError:l,pushToken:f,getPushToken:P,registerToken:S,tokenError:y,registerPlannedTrip:v,registrationLoading:w,registrationError:k}},l=()=>{n.setNotificationHandler({handleNotification:async e=>({shouldShowAlert:!0,shouldPlaySound:!0,shouldSetBadge:!0})});const e=n.addNotificationReceivedListener(e=>{console.log('[SmartDelay] Notification received:',e.request.content.body)}),t=n.addNotificationResponseReceivedListener(e=>{const t=e.notification.request.content.data;console.log('[SmartDelay] Notification tapped with data:',t),'smart_delay'===t.type&&t.tripId&&console.log(`Navigate to trip ${t.tripId}`)});return()=>{e.remove(),t.remove()}}});","lineCount":1,"map":[[1,144,55,0,"Object"],[1,151,55,0,"defineProperty"],[1,166,55,0,"_e"],[1,169,55,0],[1,186,55,0,"enumerable"],[1,198,55,0],[1,200,55,0,"get"],[1,204,55,0],[1,222,55,0,"useSmartDelay"],[1,223,55,0],[1,227,205,0,"Object"],[1,234,205,0,"defineProperty"],[1,249,205,0,"_e"],[1,252,205,0],[1,280,205,0,"enumerable"],[1,292,205,0],[1,294,205,0,"get"],[1,298,205,0],[1,316,205,0,"setupNotificationHandler"],[1,317,205,0],[1,321,11,0],[1,325,11,0,"_react"],[1,327,11,0,"r"],[1,329,11,0,"_d"],[1,332,11,0],[1,336,12,0,"Notifications"],[1,339],[1,572,12,0,"_interopNamespace"],[1,573,12,0,"r"],[1,575,12,0,"_d"],[1,578,12,0],[1,583,13,0,"AsyncStorage"],[1,585,13,0,"_interopDefault"],[1,587,13,0,"r"],[1,589,13,0,"_d"],[1,592,13,0],[1,597,14,0,"axios"],[1,599,14,0,"_interopDefault"],[1,601,14,0,"r"],[1,603,14,0,"_d"],[1,606,14,0],[1,611,16,0],[1,617,16,6,"API_URL"],[1,619,16,13],[1,643,55,13,"useSmartDelay"],[1,645,55,29,"useSmartDelay"],[1,650,56,2],[1,656,56,9,"permissionsGranted"],[1,658,56,29,"setPermissionsGranted"],[1,662,56,54],[1,664,56,54,"useState"],[1,666,56,62,"useState"],[1,677,56,63],[1,681,57,9,"permissionError"],[1,683,57,26,"setPermissionError"],[1,687,57,48],[1,689,57,48,"useState"],[1,691,57,56,"useState"],[1,701,57,72],[1,708,58,9,"pushToken"],[1,710,58,20,"setPushToken"],[1,714,58,36],[1,716,58,36,"useState"],[1,718,58,44,"useState"],[1,728,58,60],[1,735,59,9,"tokenError"],[1,737,59,21,"setTokenError"],[1,741,59,38],[1,743,59,38,"useState"],[1,745,59,46,"useState"],[1,755,59,62],[1,762,60,9,"registrationLoading"],[1,764,60,30,"setRegistrationLoading"],[1,768,60,56],[1,770,60,56,"useState"],[1,772,60,64,"useState"],[1,783,60,65],[1,787,61,9,"registrationError"],[1,789,61,28,"setRegistrationError"],[1,793,61,52],[1,795,61,52,"useState"],[1,797,61,60,"useState"],[1,807,61,76],[1,813,64,8,"requestPermissions"],[1,816,64,29],[1,818,64,29,"useCallback"],[1,820,64,40,"useCallback"],[1,833,64,41,"async"],[1,843,65,4],[1,847,66,6,"setPermissionError"],[1,849,66,25],[1,855,68,6],[1,861,68,12,"status"],[1,868,68,14,"status"],[1,877,68,31,"Notifications"],[1,879,68,45,"requestPermissionsAsync"],[1,905,69,12,"granted"],[1,907,69,33],[1,919,69,22,"status"],[1,921,72,6],[1,924,70,6,"setPermissionsGranted"],[1,926,70,28,"granted"],[1,929,72,10,"granted"],[1,931,72,19],[1,932,75,8],[1,946,74,28,"getPushToken"],[1,949,76,6],[1,950,78,6],[1,957,78,13],[1,958,79,4],[1,959,79,6],[1,965,79,13,"error"],[1,968,80,6],[1,974,80,12,"message"],[1,976,80,22,"error"],[1,989,80,39,"Error"],[1,995,80,47,"error"],[1,997,80,53,"message"],[1,1005,80,63],[1,1021,82,6],[1,1028,81,6,"setPermissionError"],[1,1030,81,25,"message"],[1,1034,82,13],[1,1035,83,4],[1,1038,84,5],[1,1042,87,8,"getPushToken"],[1,1045,87,23],[1,1047,87,23,"useCallback"],[1,1049,87,34,"useCallback"],[1,1062,87,35,"async"],[1,1072,88,4],[1,1076,89,6,"setTokenError"],[1,1078,89,20],[1,1084,93,8],[1,1090,93,14],[1,1094,93,18,"Error"],[1,1100,93,24],[1,1144,107,4],[1,1145,107,6],[1,1151,107,13,"error"],[1,1154,108,6],[1,1160,108,12,"message"],[1,1162,108,22,"error"],[1,1175,108,39,"Error"],[1,1181,108,47,"error"],[1,1183,108,53,"message"],[1,1191,108,63],[1,1207,110,6],[1,1214,109,6,"setTokenError"],[1,1216,109,20,"message"],[1,1219,110,13],[1,1223,111,4],[1,1226,112,5],[1,1230,115,8,"registerToken"],[1,1233,115,24],[1,1235,115,24,"useCallback"],[1,1237,115,35,"useCallback"],[1,1250,116,4,"async"],[1,1260,117,6],[1,1264,118,8,"setTokenError"],[1,1266,118,22],[1,1272,120,8],[1,1276,120,12,"token"],[1,1278,120,20,"pushToken"],[1,1280,125,8],[1,1283,121,13,"token"],[1,1287,122,10,"token"],[1,1295,122,24,"getPushToken"],[1,1301,125,13,"token"],[1,1303,126,10],[1,1309,126,16],[1,1313,126,20,"Error"],[1,1319,126,26],[1,1347,134,8],[1,1354,134,41],[1,1365,129,31,"axios"],[1,1367,129,36,"default"],[1,1375,129,37,"post"],[1,1380,129,42],[1,1383,129,45,"API_URL"],[1,1401,129,70],[1,1402,130,10,"token"],[1,1410,131,10,"subscription_id"],[1,1426,131,27,"subscriptionId"],[1,1431,134,24,"data"],[1,1436,134,29,"success"],[1,1443,135,6],[1,1444,135,8],[1,1450,135,15,"error"],[1,1453,136,8],[1,1459,136,14,"message"],[1,1461,136,24,"error"],[1,1474,136,41,"Error"],[1,1480,136,49,"error"],[1,1482,136,55,"message"],[1,1490,136,65],[1,1506,138,8],[1,1513,137,8,"setTokenError"],[1,1515,137,22,"message"],[1,1519,138,15],[1,1520,139,6],[1,1523,141,4],[1,1524,141,5,"pushToken"],[1,1528,145,8,"registerPlannedTrip"],[1,1531,145,30],[1,1533,145,30,"useCallback"],[1,1535,145,41,"useCallback"],[1,1548,146,4,"async"],[1,1554,146,11,"trip"],[1,1556,146,30,"subscriptionId"],[1,1561,147,6],[1,1565,148,8,"setRegistrationLoading"],[1,1568,148,31],[1,1571,149,8,"setRegistrationError"],[1,1573,149,29],[1,1579,151,8],[1,1585,151,14,"response"],[1,1593,151,31,"axios"],[1,1595,151,36,"default"],[1,1603,151,37,"post"],[1,1608,151,42],[1,1611,151,45,"API_URL"],[1,1629,151,70],[1,1633,152,13,"trip"],[1,1635,153,10,"subscription_id"],[1,1651,153,27,"subscriptionId"],[1,1655,156,8],[1,1658,156,12,"response"],[1,1660,156,21,"data"],[1,1665,156,26,"trip_id"],[1,1673,157,10],[1,1680,157,17,"response"],[1,1682,157,26,"data"],[1,1687,157,31,"trip_id"],[1,1695,160,8],[1,1701,160,14],[1,1705,160,18,"Error"],[1,1711,160,24],[1,1736,161,6],[1,1737,161,8],[1,1743,161,15,"error"],[1,1746,162,8],[1,1752,162,14,"message"],[1,1754,162,24,"error"],[1,1767,162,41,"Error"],[1,1773,162,49,"error"],[1,1775,162,55,"message"],[1,1783,162,65],[1,1799,164,8],[1,1806,163,8,"setRegistrationError"],[1,1808,163,29,"message"],[1,1811,164,15],[1,1815,165,6],[1,1816,165,7],[1,1824,166,8,"setRegistrationLoading"],[1,1827,166,31],[1,1829,167,6],[1,1832,169,4],[1,1836,188,2],[1,1843,173,2],[1,1845,173,2,"useEffect"],[1,1847,173,11,"useEffect"],[1,1858,173,12],[1,1863,174,28,"async"],[1,1874,175,6],[1,1878,176,8],[1,1884,176,14,"cached"],[1,1892,176,29,"AsyncStorage"],[1,1894,176,41,"default"],[1,1902,176,42,"getItem"],[1,1910,176,50],[1,1929,177,12,"cached"],[1,1932,178,10,"setPushToken"],[1,1934,178,23,"cached"],[1,1936,180,6],[1,1937,180,8],[1,1943,180,15,"error"],[1,1946,181,8,"console"],[1,1954,181,16,"warn"],[1,1959,181,21],[1,1995,181,58,"error"],[1,1997,182,6],[1,2000,185,4,"loadCachedToken"],[1,2004,186,5],[1,2008,188,9],[1,2009,189,4,"requestPermissions"],[1,2030,190,4,"permissionsGranted"],[1,2051,191,4,"permissionError"],[1,2069,192,4,"pushToken"],[1,2081,193,4,"getPushToken"],[1,2096,194,4,"registerToken"],[1,2112,195,4,"tokenError"],[1,2125,196,4,"registerPlannedTrip"],[1,2147,197,4,"registrationLoading"],[1,2169,198,4,"registrationError"],[1,2191,205,13,"setupNotificationHandler"],[1,2193,205,40,"setupNotificationHandler"],[1,2198,207,2,"Notifications"],[1,2200,207,16,"setNotificationHandler"],[1,2223,207,39],[1,2224,208,4,"handleNotification"],[1,2243,208,24,"async"],[1,2253,210,13],[1,2254,211,8,"shouldShowAlert"],[1,2271,211,25],[1,2273,212,8,"shouldPlaySound"],[1,2290,212,25],[1,2292,213,8,"shouldSetBadge"],[1,2308,213,24],[1,2314,219,2],[1,2320,219,8,"subscription"],[1,2322,219,23,"Notifications"],[1,2324,219,37,"addNotificationReceivedListener"],[1,2356,219,70,"notification"],[1,2360,220,4,"console"],[1,2368,220,12,"log"],[1,2372,220,16],[1,2410,220,55,"notification"],[1,2412,220,68,"request"],[1,2420,220,76,"content"],[1,2428,220,84,"body"],[1,2436,224,8,"responseSubscription"],[1,2438,224,31,"Notifications"],[1,2440,224,45,"addNotificationResponseReceivedListener"],[1,2480,225,5,"response"],[1,2484,226,6],[1,2490,226,12,"data"],[1,2492,226,19,"response"],[1,2494,226,28,"notification"],[1,2507,226,41,"request"],[1,2515,226,49,"content"],[1,2523,226,57,"data"],[1,2528,227,6,"console"],[1,2536,227,14,"log"],[1,2540,227,18],[1,2586,227,65,"data"],[1,2589,230,24],[1,2605,230,10,"data"],[1,2607,230,15,"type"],[1,2613,230,41,"data"],[1,2615,230,46,"tripId"],[1,2623,231,8,"console"],[1,2631,231,16,"log"],[1,2635,231,20],[1,2655,231,40,"data"],[1,2657,231,45,"tripId"],[1,2669,237,2],[1,2675,237,9],[1,2680,238,4,"subscription"],[1,2682,238,17,"remove"],[1,2691,239,4,"responseSubscription"],[1,2693,239,25,"remove"],[1,2703,241,2],[1,2706]],"functionMap":{"names":["<global>","useSmartDelay","requestPermissions","getPushToken","registerToken","registerPlannedTrip","useEffect$argument_0","loadCachedToken","setupNotificationHandler","Notifications.setNotificationHandler$argument_0.handleNotification","Notifications.addNotificationReceivedListener$argument_0","Notifications.addNotificationResponseReceivedListener$argument_0","<anonymous>"],"mappings":"AAA;6BCsD;yCCS;GDoB;mCEG;GFyB;IGI;KHwB;IIM;KJsB;YKK;4BCC;KDS;GLG;CDc;wCQK;wBCG;KDO;qEEI;GFE;IGI;KHS;SIG;GJG;CRC"},"hasCjsExports":false},"type":"js/module"}]}